---
---

<!-- Progress bar -->
<div
  id="progress-bar"
  class="fixed left-0 top-0 z-50 h-[3px] bg-accent transition-[width] duration-150"
  style="width: 0%"
>
</div>

<!-- Back to Top button -->
<button
  id="back-to-top"
  class="fixed bottom-8 right-8 z-50 flex items-center gap-2 rounded-full bg-accent px-4 py-2 text-sm font-medium text-background opacity-0 shadow-lg transition-opacity duration-300 pointer-events-none hover:opacity-90"
  aria-label="Back to top"
  tabindex="-1"
>
  <svg
    class="size-4"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    viewBox="0 0 24 24"
  >
    <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"
    ></path>
  </svg>
  Back to Top
</button>

<script>
  function initScroll() {
    const bar = document.getElementById("progress-bar");
    const backToTop = document.getElementById("back-to-top");
    if (!bar) return;

    let ticking = false;

    function onScroll() {
      if (!ticking) {
        requestAnimationFrame(() => {
          const scrollTop = window.scrollY;
          const docHeight =
            document.documentElement.scrollHeight - window.innerHeight;
          const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
          bar.style.width = `${progress}%`;

          if (backToTop) {
            if (scrollTop > 300) {
              backToTop.classList.remove("opacity-0", "pointer-events-none");
              backToTop.classList.add("opacity-100");
              backToTop.setAttribute("tabindex", "0");
            } else {
              backToTop.classList.add("opacity-0", "pointer-events-none");
              backToTop.classList.remove("opacity-100");
              backToTop.setAttribute("tabindex", "-1");
            }
          }
          ticking = false;
        });
        ticking = true;
      }
    }

    window.addEventListener("scroll", onScroll, { passive: true });
    onScroll();

    if (backToTop) {
      backToTop.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    }
  }

  initScroll();
  document.addEventListener("astro:after-swap", initScroll);
</script>
