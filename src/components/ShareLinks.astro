---
interface Props {
  title: string;
  url: string;
}

const { title, url } = Astro.props;

const encodedTitle = encodeURIComponent(title);
const encodedUrl = encodeURIComponent(url);

const shares = [
  {
    name: "X",
    href: `https://x.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`,
  },
  {
    name: "LinkedIn",
    href: `https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`,
  },
  {
    name: "WhatsApp",
    href: `https://wa.me/?text=${encodedTitle}%20${encodedUrl}`,
  },
  {
    name: "Facebook",
    href: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
  },
  {
    name: "Telegram",
    href: `https://t.me/share/url?url=${encodedUrl}&text=${encodedTitle}`,
  },
  {
    name: "Threads",
    href: `https://www.threads.net/intent/post?text=${encodedTitle}%20${encodedUrl}`,
  },
  {
    name: "HackerNews",
    href: `https://news.ycombinator.com/submitlink?u=${encodedUrl}&t=${encodedTitle}`,
  },
  {
    name: "Pinterest",
    href: `https://pinterest.com/pin/create/button/?url=${encodedUrl}&description=${encodedTitle}`,
  },
  {
    name: "Email",
    href: `mailto:?subject=${encodedTitle}&body=${encodedUrl}`,
  },
];
---

<div
  class="flex flex-col flex-wrap items-center justify-center gap-2 sm:items-start sm:gap-1"
>
  <span class="italic">Share this post on:</span>
  <div class="flex flex-wrap gap-1 text-center">
    {
      shares.map((share) => (
        <a
          href={share.href}
          target={share.name === "Email" ? undefined : "_blank"}
          rel={share.name === "Email" ? undefined : "noopener noreferrer"}
          class="group inline-block p-2 hover:rotate-6 hover:text-accent sm:p-1"
          title={`Share on ${share.name}`}
        >
          {share.name === "X" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M4 4l11.733 16h4.267l-11.733 -16z" />
              <path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772" />
            </svg>
          )}
          {share.name === "LinkedIn" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" />
              <path d="M8 11l0 5" />
              <path d="M8 8l0 .01" />
              <path d="M12 16l0 -5" />
              <path d="M16 16v-3a2 2 0 0 0 -4 0" />
            </svg>
          )}
          {share.name === "WhatsApp" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9" />
              <path d="M9 10a.5 .5 0 0 0 1 0v-1a.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a.5 .5 0 0 0 0 -1h-1a.5 .5 0 0 0 0 1" />
            </svg>
          )}
          {share.name === "Facebook" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3" />
            </svg>
          )}
          {share.name === "Telegram" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4" />
            </svg>
          )}
          {share.name === "Threads" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M19 7.5c-1.333 -3 -3.667 -4.5 -7 -4.5c-5 0 -8 2.5 -8 9s3.8 9 8 9c4 0 7 -2.5 7 -6s-3 -5 -5 -5c-2 0 -3 1 -3 2s1 2 3 2c2.5 0 3.5 -2 3.5 -4s-1.5 -4 -4.5 -4" />
            </svg>
          )}
          {share.name === "HackerNews" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" />
              <path d="M8 7l4 7l4 -7" />
              <path d="M12 14v4" />
            </svg>
          )}
          {share.name === "Pinterest" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M8 20l4 -9" />
              <path d="M10.7 14c.437 1.263 1.43 2 2.55 2c2.071 0 3.75 -1.554 3.75 -4a5 5 0 1 0 -9.7 1.7" />
              <circle cx="12" cy="12" r="10" />
            </svg>
          )}
          {share.name === "Email" && (
            <svg
              class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" />
              <path d="M3 7l9 6l9 -6" />
            </svg>
          )}
          <span class="sr-only">Share on {share.name}</span>
        </a>
      ))
    }
    <!-- Copy link button -->
    <button
      id="copy-link-btn"
      class="group inline-block p-2 hover:rotate-6 hover:text-accent sm:p-1"
      title="Copy link to clipboard"
      data-url={url}
    >
      <svg
        id="copy-icon"
        class="inline-block size-8 fill-transparent stroke-current stroke-2 opacity-90 sm:size-6"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path d="M9 15l6 -6" />
        <path d="M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464" />
        <path d="M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463" />
      </svg>
      <svg
        id="copy-check-icon"
        class="hidden inline-block size-8 fill-transparent stroke-current stroke-2 text-accent sm:size-6"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path d="M5 12l5 5l10 -10" />
      </svg>
      <span class="sr-only">Copy link</span>
    </button>
  </div>
</div>

<script>
  function initCopyLink() {
    const btn = document.getElementById("copy-link-btn");
    if (!btn) return;
    const copyIcon = document.getElementById("copy-icon");
    const checkIcon = document.getElementById("copy-check-icon");
    const url = btn.getAttribute("data-url");

    btn.addEventListener("click", async () => {
      if (!url) return;
      try {
        await navigator.clipboard.writeText(url);
        copyIcon?.classList.add("hidden");
        checkIcon?.classList.remove("hidden");
        setTimeout(() => {
          copyIcon?.classList.remove("hidden");
          checkIcon?.classList.add("hidden");
        }, 2000);
      } catch {
        const input = document.createElement("input");
        input.value = url;
        document.body.appendChild(input);
        input.select();
        document.execCommand("copy");
        document.body.removeChild(input);
        copyIcon?.classList.add("hidden");
        checkIcon?.classList.remove("hidden");
        setTimeout(() => {
          copyIcon?.classList.remove("hidden");
          checkIcon?.classList.add("hidden");
        }, 2000);
      }
    });
  }

  initCopyLink();
  document.addEventListener("astro:after-swap", initCopyLink);
</script>
